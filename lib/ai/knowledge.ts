export interface TaxKnowledge {
    id: string;
    title: string;
    source: string;
    content: string;
    keywords: string[];
}

export const TAX_KNOWLEDGE: TaxKnowledge[] = [
    {
        id: "m65-tri",
        title: "มาตรา 65 ตรี (รายจ่ายต้องห้าม)",
        source: "ประมวลรัษฎากร",
        content: "มาตรา 65 ตรี รายจ่ายดังต่อไปนี้ ไม่ให้ใช้เป็นรายจ่ายในการคำนวณกำไรสุทธิ... (13) รายจ่ายที่มีลักษณะเป็นการส่วนตัว การให้โดยเสน่หา หรือการกุศล เว้นแต่รายจ่ายเพื่อการสาธารณประโยชน์ หรือเพื่อการศึกษาหรือเพื่อการกีฬา ตามที่อธิบดีกำหนดโดยอนุมัติรัฐมนตรี",
        keywords: ["รายจ่ายต้องห้าม", "เสน่หา", "การกุศล", "65 ตรี"],
    },
    {
        id: "m65-bis",
        title: "มาตรา 65 ทวิ (เงื่อนไขการคำนวณกำไรสุทธิ)",
        source: "ประมวลรัษฎากร",
        content: "การคำนวณกำไรสุทธิและขาดทุนสุทธิเพื่อเสียภาษีตามส่วนนี้ ให้เป็นไปตามเงื่อนไขดังต่อไปนี้... (1) รายการที่ระบุไว้ในมาตรา 65 ตรี ไม่ให้ถือเป็นรายจ่าย",
        keywords: ["กำไรสุทธิ", "เงื่อนไข", "65 ทวิ"],
    },
    {
        id: "m143",
        title: "กฎกระทรวง ฉบับที่ 143 (พ.ศ. 2522)",
        source: "กฎกระทรวง",
        content: "กำหนดหลักเกณฑ์การหักค่ารับรองหรือค่าบริการที่เกี่ยวกับธุรกิจ... ค่าของขวัญหรือของกำนัลที่ให้แก่บุคคลแต่ละคนในแต่ละคราวที่มีวาระสำคัญตามประเพณีหรือธุรกิจ ไม่เกิน 2,000 บาท",
        keywords: ["ค่ารับรอง", "ของขวัญ", "2,000", "143"],
    },
    {
        id: "vat-base",
        title: "มาตรา 77/1 (คำนิยาม VAT)",
        source: "ประมวลรัษฎากร",
        content: "ในส่วนนี้... (8) 'สินค้า' หมายความว่า ทรัพย์สินที่มีรูปร่างและไม่มีรูปร่าง ที่อาจมีราคาและถือเอาได้ ไม่ว่าจะมีไว้เพื่อขาย เพื่อใช้ หรือเพื่อการใดๆ",
        keywords: ["VAT", "สินค้า", "นิยาม", "ภาษีมูลค่าเพิ่ม"],
    }
];

export function getRelevantKnowledge(query: string): string {
    const relevant = TAX_KNOWLEDGE.filter(k =>
        k.keywords.some(kw => query.includes(kw)) ||
        k.title.includes(query) ||
        k.content.includes(query)
    );

    if (relevant.length === 0) return "";

    return "\n\nข้อมูอ้างอิงทางกฎหมายที่เกี่ยวข้อง:\n" +
        relevant.map(k => `[${k.title}]\n${k.content}`).join("\n\n");
}
